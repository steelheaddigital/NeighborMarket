<%
#
#Copyright 2013 Neighbor Market
#
#This file is part of Neighbor Market.
#
#Neighbor Market is free software: you can redistribute it and/or modify
#it under the terms of the GNU General Public License as published by
#the Free Software Foundation, either version 3 of the License, or
#(at your option) any later version.
#
#Neighbor Market is distributed in the hope that it will be useful,
#but WITHOUT ANY WARRANTY; without even the implied warranty of
#MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
#GNU General Public License for more details.
#
#You should have received a copy of the GNU General Public License
#along with Neighbor Market.  If not, see <http://www.gnu.org/licenses/>.
#
%>

<div class="container-fluid">
	<div class="well-fluid container-fluid">
	  <div class="col-md-3 col-sm-4">
		<div class="row">
		    <%if inventory_item.photo?%>
		      <%= image_tag inventory_item.photo.url(:medium), class: "img-responsive" %>
		    <%else%>
		      No Image Available
		    <%end%>
		</div>
	  </div>
	  <div class="col-md-9 col-sm-8 itemDescription">
		<div class="row">
			<div class="container-fluid">
				<div class="row">
					<div class="col-md-12 itemDescription">
					    <h2>
					      <%= item_name(inventory_item) %>
					    </h2>
					    <p><%= inventory_item.description %></p>
					</div>
				</div>
				<div class="row">
					<div class="col-md-12">
						<div class="row">
							<div class="col-md-4">
							    <p><label>Quantity Available:</label><%= quantity(inventory_item)%></p>
							    <p><label>Price:</label><%= number_to_currency(inventory_item.price).to_s + " " + price_unit_label(inventory_item) %></p>
							    <p>
									<label>Sold By:</label>
									<%if inventory_item.user.photo?%>
										<a href="<%=user_path(inventory_item.user.id)%>" class="inventorySellerLink"><%= image_tag inventory_item.user.photo.url(:thumb), class: "img-responsive" %><%=inventory_item.user.username%></a>
									<%else%>
										<%= link_to(inventory_item.user.username, user_path(inventory_item.user.id)) %>
									<%end%>
								</p>
							</div>
							<div class="col-md-8">
								<% if inventory_item.quantity_available > 0 %>
							        <%= form_tag(cart_items_path(:inventory_item_id => inventory_item.id), :class => "addToCartButton") do %>
							        <p><label>Quantity:</label><input id="quantity" name="quantity" style="width: 40px;" value="1"></input><span> <%= item_quantity_label(inventory_item, 2) %></span></p>
							        <p><%= submit_tag("Add To Cart", :class => "btn btn-primary") %></p>
							        <% end %>
								<% end %>
							</div>
						</div>
					</div>
				</div>
				<% if SiteSetting.first.reputation_enabled && !inventory_item.avg_rating.nil? %>
					<div class="row">
						<div class="col-md-12">
							<h3>Reviews (<%=inventory_item.reviews.count%>)</h3>
							<p>
								<span>
									<%= radio_button_tag "rating", 0.5, inventory_item.avg_rating > 0 && inventory_item.avg_rating <= 0.5, class: "star {split:2}", disabled: "disabled" %>
									<%= radio_button_tag "rating", 1, inventory_item.avg_rating > 0.5 && inventory_item.avg_rating <= 1, class: "star {split:2}", disabled: "disabled" %>
									<%= radio_button_tag "rating", 1.5, inventory_item.avg_rating > 1 && inventory_item.avg_rating <= 1.5, class: "star {split:2}", disabled: "disabled" %>
									<%= radio_button_tag "rating", 2, inventory_item.avg_rating > 1.5 && inventory_item.avg_rating <= 2, class: "star {split:2}", disabled: "disabled" %>
									<%= radio_button_tag "rating", 2.5, inventory_item.avg_rating > 2 && inventory_item.avg_rating <= 2.5, class: "star {split:2}", disabled: "disabled" %>
									<%= radio_button_tag "rating", 3, inventory_item.avg_rating > 2.5 && inventory_item.avg_rating <= 3, class: "star {split:2}", disabled: "disabled" %>
									<%= radio_button_tag "rating", 3.5, inventory_item.avg_rating > 3 && inventory_item.avg_rating <= 3.5, class: "star {split:2}", disabled: "disabled" %>
									<%= radio_button_tag "rating", 4, inventory_item.avg_rating > 3.5 && inventory_item.avg_rating <= 4, class: "star {split:2}", disabled: "disabled" %>
									<%= radio_button_tag "rating", 4.5, inventory_item.avg_rating > 4 && inventory_item.avg_rating <= 4.5, class: "star {split:2}", disabled: "disabled" %>
									<%= radio_button_tag "rating", 5, inventory_item.avg_rating > 4.5 && inventory_item.avg_rating <= 5, class: "star {split:2}", disabled: "disabled" %>
								</span>
								<span class="avgRating"><%= inventory_item.avg_rating %> average rating</span>
							</p>
							<div class="reviewsContainer">
								<% @reviews.each do |review| %>
								<div class="panel panel-default">
									<div class="panel-body">
										<span>
											<%= radio_button_tag "rating#{review.id}", 1, !review.rating.nil? && review.rating == 1, class: "star", disabled: "disabled" %>
											<%= radio_button_tag "rating#{review.id}", 2, !review.rating.nil? && review.rating == 2, class: "star", disabled: "disabled" %>
											<%= radio_button_tag "rating#{review.id}", 3, !review.rating.nil? && review.rating == 3, class: "star", disabled: "disabled" %>
											<%= radio_button_tag "rating#{review.id}", 4, !review.rating.nil? && review.rating == 4, class: "star", disabled: "disabled" %>
											<%= radio_button_tag "rating#{review.id}", 5, !review.rating.nil? && review.rating == 5, class: "star", disabled: "disabled" %>
										</span>
										<span class="avgRating">
											By <%= review.username%> <span><%= format_short_date(review.updated_at)%></span>
										</span>
										<p>
											<%= review.review %>
										</p>
									</div>
								</div>
								<%end%>
								<%= will_paginate @reviews %>
							</div>
						</div>
					</div>
				<% end %>
			</div>
	 	 </div>
	</div>
</div>