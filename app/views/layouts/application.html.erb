<%
#
#Copyright 2013 Neighbor Market
#
#This file is part of Neighbor Market.
#
#Neighbor Market is free software: you can redistribute it and/or modify
#it under the terms of the GNU General Public License as published by
#the Free Software Foundation, either version 3 of the License, or
#(at your option) any later version.
#
#Neighbor Market is distributed in the hope that it will be useful,
#but WITHOUT ANY WARRANTY; without even the implied warranty of
#MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
#GNU General Public License for more details.
#
#You should have received a copy of the GNU General Public License
#along with Neighbor Market.  If not, see <http://www.gnu.org/licenses/>.
#
%>


<!DOCTYPE html>
<html>
<head>
  <title>Neighbor Market</title>
  <%= stylesheet_link_tag "application" %>
  <%= javascript_include_tag "application" %>
  <%= csrf_meta_tags %>
  <link href='http://fonts.googleapis.com/css?family=Josefin+Slab' rel='stylesheet' type='text/css'>
<body>
  <div class="navbar navbar-fixed-top">
      <div class="navbar-inner">
        <div class="container-fluid">
          <a class="btn btn-navbar" data-target=".nav-collapse" data-toggle="collapse">
            <span class="icon-bar"></span>
            <span class="icon-bar"></span>
            <span class="icon-bar"></span>
          </a>
		  <%= link_to('Neighbor Market', root_path, {:class => "brand"}) %>
          <div class="nav-collapse collapse">
            <ul class="nav">
              <li><%= link_to "Home", root_path %></li>
              <% if user_signed_in? && current_user.manager?%>
                  <li><%= link_to('Manage', edit_site_settings_management_index_path) %></li>
              <% end %>
              <% if user_signed_in? && current_user.approved_seller? %>
                  <li><%= link_to('Sell', seller_index_path) %></li>
              <% end %>
              <% if @current_order_id %>
                  <li><%= link_to('My Order', edit_order_path(@current_order_id)) %></li>
              <% end %>
              <% if @completed_order_id %>
                  <li><%= link_to('My Order', order_path(@completed_order_id)) %></li>
              <% end %>
            </ul>
            <ul class="pull-right nav">
              <% if user_signed_in? %>
                <li><%= link_to('Logout', destroy_user_session_path, :method => :delete) %></li>        
              <% else %>
                <li><%= link_to('Login', new_user_session_path)  %></li>  
              <% end %>
              <% if user_signed_in? %>
                <li><%= link_to('Edit profile', edit_user_registration_url) %></li>
                <% if !current_user.seller?%>
                  <li><%= link_to('Become a seller', become_seller_url) %></li>
                <% end %>
                <% if !current_user.buyer?%>
                  <li><%= link_to('Become a buyer', become_buyer_url) %></li>
                <% end %>
              <% else %>
                <li><%= link_to('Sign up as a buyer', buyer_sign_up_url) %></li>
                <li><%= link_to('Sign up as a seller', seller_sign_up_url) %></li>
              <% end %>
            </ul>
          </div>
        </div>
      </div>
  </div>
  <div class="container-fluid">
    <div class="subhead">
      <div class="subnav subnav-fixed" style="min-width:620px;">
        <ul class ="nav nav-pills">
          <li class="dropdown" id="MainCategoriesMenu">
            <a class="dropdown-toggle" data-toggle="dropdown" href="#">
            Browse Categories
            <b class="caret"></b>
            </a>
            <ul class="dropdown-menu">
              <% @TopLevelCategories = get_categories %>
              <% @TopLevelCategories.each do |category| %>
                <li class="dropdown offset-right">
				  <a href="#"><%= category[:name] %>
				  	<span>(<%= category[:count] %>)</span>
				  </a>
                  <ul class="dropdown-menu">
                    <% category[:second_level].each do |second_level_category|%>
                    <li>
                        <a href="<%= browse_inventory_items_path(:second_level_category_id => second_level_category[:id]) %>" class="secondLevelBrowseMenu"><%= second_level_category[:name] %> 
						<span>(<%= second_level_category[:count] %>)</span>
						</a>
                    </li>
                    <% end %>
                  </ul>
                </li>
              <%  end %>
            </ul>
          </li>
          <li>
            <form id="MainSearchForm" class="form-inline" action="<%= search_inventory_items_url %>">
              <input name="keywords" type="text"></input>
              <button type="submit" class="btn">Search</button>
            </form>
          </li>
          <li class="pull-right">
            <a id ="CartButton" href= "<%= cart_index_path %>" >
            <i class="icon-shopping-cart"></i>
            <span id="CartCount" class="badge badge-info pull-right" style="margin-left:10px;"><%= current_cart.cart_items.count %></span>
            Shopping Cart
            </a>
          </li>
        </ul>
      </div>
    </div>
    <div class="alert alert-block orderCycleAlert">
     	<%= order_cycle_message %>
    </div>
  <div id="MainContent">
    <div style="margin-bottom: 5px;">
		<div id ="FlashMessages" class="alert alert-info">
			<div id="FlashNotice">
				<%= flash[:notice] %>
			</div>
			<div id="FlashAlert">
				<%= flash[:alert] %>
			</div>
		</div>
	</div>
  	<%= content_for?(:MainContent) ? yield(:MainContent) : yield %>
  </div>
  <div id="InventoryModal" class="modal hide fade" tabindex="-1" data-width="760">
  </div>
  <script>
  	$('.dropdown-toggle').dropdown();
	$("#InventoryModal").modal({show: false});
  </script>
</body>
</html>
