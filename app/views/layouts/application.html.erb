<%
#
#Copyright 2013 Neighbor Market
#
#This file is part of Neighbor Market.
#
#Neighbor Market is free software: you can redistribute it and/or modify
#it under the terms of the GNU General Public License as published by
#the Free Software Foundation, either version 3 of the License, or
#(at your option) any later version.
#
#Neighbor Market is distributed in the hope that it will be useful,
#but WITHOUT ANY WARRANTY; without even the implied warranty of
#MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
#GNU General Public License for more details.
#
#You should have received a copy of the GNU General Public License
#along with Neighbor Market.  If not, see <http://www.gnu.org/licenses/>.
#
%>


<!DOCTYPE html>
<html>
	<head>
	  <title><%= site_name %></title>
	  <%= stylesheet_link_tag "application" %>
	  <%= javascript_include_tag "application" %>
	  <%= csrf_meta_tags %>
	  <meta name="viewport" content="width=device-width, initial-scale=1.0">
	  <%= content_for :open_graph_tags %>
	</head>
	<body>
		<div class="navbar navbar-default navbar-fixed-top">
	        <div class="container-fluid">
				<div class="navbar-header">
			      <button class="navbar-toggle" data-target=".navbar-collapse" data-toggle="collapse" type="button">
			        <span class="icon-bar"></span>
			        <span class="icon-bar"></span>
			        <span class="icon-bar"></span>
			      </button>
				</div>
				<div class="navbar-collapse collapse">
					<ul class="nav navbar-nav">
					  <li><%= link_to "Home", root_path %></li>
					  <% if user_signed_in? && current_user.manager?%>
					      <li><%= link_to('Manage', edit_site_settings_management_index_path) %></li>
					  <% end %>
					  <% if user_signed_in? && current_user.approved_seller? %>
					      <li><%= link_to('Sell', seller_index_path) %></li>
					  <% end %>
					  <% if @current_order_id %>
					      <li><%= link_to('My Order', edit_order_path(@current_order_id)) %></li>
					  <% end %>
					  <% if @completed_order_id %>
					      <li><%= link_to('My Order', order_path(@completed_order_id)) %></li>
					  <% end %>
					</ul>
					<ul class="nav navbar-nav navbar-right">
					  <% if user_signed_in? %>
					    <li><%= link_to('Logout', destroy_user_session_path, :method => :delete) %></li>        
					  <% else %>
					    <li><%= link_to('Login', new_user_session_path)  %></li>  
					  <% end %>
					  <% if user_signed_in? %>
					    <li><%= link_to('Edit profile', edit_user_registration_url) %></li>
					    <% if !current_user.seller?%>
					      <li><%= link_to('Become a seller', become_seller_url) %></li>
					    <% end %>
					    <% if !current_user.buyer?%>
					      <li><%= link_to('Become a buyer', become_buyer_url) %></li>
					    <% end %>
					  <% else %>
					    <li><%= link_to('Sign up as a buyer', buyer_sign_up_url) %></li>
					    <li><%= link_to('Sign up as a seller', seller_sign_up_url) %></li>
					  <% end %>
					</ul>
				</div>
			</div>
		</div>
		<div class="container-fluid search-container">
			<ul class ="nav nav-pills navbar-left">
			  <li class="dropdown" id="MainCategoriesMenu">
			    <a class="dropdown-toggle" data-toggle="dropdown" href="#">
			    Browse Categories
			    <b class="caret"></b>
			    </a>
			    <ul class="dropdown-menu">
				<% cache(cache_key_for_categories) do %>
			      <% top_level_categories = get_categories %>
			      <% top_level_categories.each do |category| %>
			        <li class="dropdown-submenu">
					  <a href="#"><%= category[:name] %>
					  	<span>(<%= category[:count] %>)</span>
					  </a>
			          <ul class="dropdown-menu">
			            <% category[:second_level].each do |second_level_category|%>
			            <li>
			                <a href="<%= browse_inventory_items_path(:second_level_category_id => second_level_category[:id]) %>" class="secondLevelBrowseMenu"><%= second_level_category[:name] %> 
							<span>(<%= second_level_category[:count] %>)</span>
							</a>
			            </li>
			            <% end %>
			          </ul>
			        </li>
			      <% end %>
				  <% end %>
			    </ul>
			  </li>
			</ul>
			    <form id="MainSearchForm" class="form-inline navbar-left" action="<%= search_inventory_items_path %>">
					<div class="form-group">
						<div class="input-group">
			      	  		<input name="keywords" type="text" class="form-control" style="width: 300px;" placeholder="What are you looking for?"></input>
							<button type="submit" class="btn btn-success icon-search" style="border-bottom-left-radius: 0; border-top-left-radius: 0; line-height: 22px; font-size: 22px;"></button>
						</div>
					</div>
			    </form>
			<ul class="nav nav-pills navbar-right">
			  <li>
			    <a id ="CartButton" href= "<%= cart_index_path %>" >
			    <i class="icon-shopping-cart"></i>
			    <span id="CartCount" class="badge badge-info pull-right" style="margin-left:10px;"><%= current_cart.cart_items.count %></span>
			    Shopping Cart
			    </a>
			  </li>
		   </ul>
		</div>
		<div class="container-fluid">
			<div class="alert alert-danger orderCycleAlert">
				<%= order_cycle_message %>
			</div>
		</div>
	  	<div id="MainContent">
			<div class="container-fluid" style="margin-bottom: 5px; margin-top:5px;">
				<div id ="FlashMessages" class="alert alert-info">
					<div id="FlashNotice">
						<%= flash[:notice] %>
					</div>
					<div id="FlashAlert">
						<%= flash[:alert] %>
					</div>
				</div>
			</div>
		  	<%= content_for?(:MainContent) ? yield(:MainContent) : yield %>
	  	</div>
		<div id="InventoryModal" class="modal fade" tabindex="-1" data-width="760">
		</div>
	</body>
	<script>
	  $(function() {
	  	$("#InventoryModal").modal({show: false});
	  	$(".icon-question-sign").tooltip();
	  })
	</script>
</html>
